<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” ì‹¤ì œ ì‹œìŠ¤í…œ ì‹œì£¼ ê³„ì‚° í…ŒìŠ¤íŠ¸</title>
    <script src="saju-core-functions.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .test-box { background: #f0f8ff; padding: 20px; margin: 15px 0; border-radius: 8px; border: 2px solid #007bff; }
        .error { color: red; font-weight: bold; }
        .success { color: green; font-weight: bold; }
        .highlight { background: yellow; padding: 3px; font-weight: bold; }
        table { border-collapse: collapse; width: 100%; margin: 15px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: center; }
        th { background-color: #f2f2f2; }
        .step-by-step { background: white; padding: 10px; margin: 8px 0; border-left: 4px solid #007bff; }
    </style>
</head>
<body>
    <h1>ğŸ” ì‹¤ì œ ì‹œìŠ¤í…œ ì‹œì£¼ ê³„ì‚° í…ŒìŠ¤íŠ¸</h1>
    <p><strong>ëª©í‘œ</strong>: saju-core-functions.jsë¥¼ ì‚¬ìš©í•´ì„œ ì‹¤ì œ ì‹œì£¼ ê³„ì‚° ê³¼ì • ì¶”ì </p>

    <div id="test-output"></div>

    <script>
        // ì‹¤ì œ ì‹œìŠ¤í…œ í•¨ìˆ˜ë“¤ì„ ì‚¬ìš©í•œ í…ŒìŠ¤íŠ¸
        function testRealSystem() {
            console.log('\nğŸ” === ì‹¤ì œ ì‹œìŠ¤í…œ ì‹œì£¼ ê³„ì‚° í…ŒìŠ¤íŠ¸ ===');

            // í…ŒìŠ¤íŠ¸ ë°ì´í„°
            const testDate = new Date(1989, 9, 6); // 1989ë…„ 10ì›” 6ì¼
            const testHour = 12;

            console.log(`í…ŒìŠ¤íŠ¸ ë‚ ì§œ: ${testDate.getFullYear()}-${testDate.getMonth()+1}-${testDate.getDate()}`);
            console.log(`í…ŒìŠ¤íŠ¸ ì‹œê°„: ${testHour}ì‹œ`);

            // 1ë‹¨ê³„: ì „ì²´ ì‚¬ì£¼ ê³„ì‚° (ì‹¤ì œ ì‹œìŠ¤í…œ í•¨ìˆ˜ ì‚¬ìš©)
            console.log('\n--- 1ë‹¨ê³„: ì „ì²´ ì‚¬ì£¼ ê³„ì‚° ---');
            const sajuResult = calculateë§Œì„¸ë ¥(testDate, testHour);
            console.log('ì‚¬ì£¼ ê³„ì‚° ê²°ê³¼:', sajuResult);

            // 2ë‹¨ê³„: ì¼ì£¼ë§Œ ë”°ë¡œ ê³„ì‚°
            console.log('\n--- 2ë‹¨ê³„: ì¼ì£¼ ë³„ë„ ê³„ì‚° ---');
            const dayGapja = getDayGapja(testDate.getFullYear(), testDate.getMonth() + 1, testDate.getDate());
            const dayGan = ì²œê°„[dayGapja % 10];
            const dayJi = ì§€ì§€[dayGapja % 12];
            console.log(`ì¼ì£¼ ê°‘ì: ${dayGapja}`);
            console.log(`ì¼ê°„: ${dayGan}, ì¼ì§€: ${dayJi}`);
            console.log(`ì¼ì£¼: ${dayGan}${dayJi}`);

            // 3ë‹¨ê³„: ì‹œì£¼ë§Œ ë”°ë¡œ ê³„ì‚°
            console.log('\n--- 3ë‹¨ê³„: ì‹œì£¼ ë³„ë„ ê³„ì‚° ---');
            const hourResult = getHourGapja(dayGan, testHour);
            console.log(`ì…ë ¥ â†’ ì¼ê°„: ${dayGan}, ì‹œê°„: ${testHour}`);
            console.log(`ì‹œì£¼ ê³„ì‚° ê²°ê³¼:`, hourResult);
            console.log(`ì‹œì£¼: ${hourResult.gan}${hourResult.ji}`);

            // 4ë‹¨ê³„: ë‹¨ê³„ë³„ ê²€ì¦
            console.log('\n--- 4ë‹¨ê³„: ë‹¨ê³„ë³„ ê²€ì¦ ---');

            // dayGanIndex í™•ì¸
            const dayGanIndex = ì²œê°„.indexOf(dayGan);
            console.log(`dayGanIndex = ì²œê°„.indexOf("${dayGan}") = ${dayGanIndex}`);

            // hourJiIndex í™•ì¸ (12ì‹œ â†’ ì˜¤ì‹œ)
            let hourJiIndex;
            if (testHour >= 11 && testHour <= 12) hourJiIndex = 6;
            console.log(`${testHour}ì‹œ â†’ ì˜¤ì‹œ â†’ hourJiIndex = ${hourJiIndex}`);

            // ì¼ê°„ë³„ìì‹œì²œê°„ ë§¤í•‘ í™•ì¸
            const ì¼ê°„ë³„ìì‹œì²œê°„ = {
                0: 0, 4: 0,  // ê°‘(0), ê¸°(4) â†’ ê°‘ìì‹œ(0)
                1: 2, 5: 2,  // ì„(1), ê²½(5) â†’ ë³‘ìì‹œ(2)
                2: 4, 6: 4,  // ë³‘(2), ì‹ (6) â†’ ë¬´ìì‹œ(4)
                3: 6, 7: 6,  // ì •(3), ì„(7) â†’ ê²½ìì‹œ(6)
                8: 8, 9: 8   // ë¬´(8), ê³„(9) â†’ ì„ìì‹œ(8)
            };

            const ìì‹œì²œê°„ = ì¼ê°„ë³„ìì‹œì²œê°„[dayGanIndex];
            console.log(`ì¼ê°„ë³„ìì‹œì²œê°„[${dayGanIndex}] = ${ìì‹œì²œê°„}`);
            console.log(`ë§¤í•‘ í…Œì´ë¸”:`, ì¼ê°„ë³„ìì‹œì²œê°„);

            // ìµœì¢… ê³„ì‚° í™•ì¸
            const expectedHourGanIndex = (ìì‹œì²œê°„ + hourJiIndex) % 10;
            const expectedHourGan = ì²œê°„[expectedHourGanIndex];
            console.log(`ì˜ˆìƒ hourGanIndex = (${ìì‹œì²œê°„} + ${hourJiIndex}) % 10 = ${expectedHourGanIndex}`);
            console.log(`ì˜ˆìƒ ì‹œê°„ ì²œê°„ = ì²œê°„[${expectedHourGanIndex}] = ${expectedHourGan}`);

            // ì‹¤ì œ vs ì˜ˆìƒ ë¹„êµ
            console.log('\n--- 5ë‹¨ê³„: ê²°ê³¼ ë¹„êµ ---');
            console.log(`ì‹¤ì œ ì‹œê°„ ì²œê°„: ${hourResult.gan}`);
            console.log(`ì˜ˆìƒ ì‹œê°„ ì²œê°„: ${expectedHourGan}`);
            console.log(`ì¼ì¹˜ ì—¬ë¶€: ${hourResult.gan === expectedHourGan ? 'âœ… ì¼ì¹˜' : 'âŒ ë¶ˆì¼ì¹˜'}`);

            if (hourResult.gan !== expectedHourGan) {
                const actualIndex = ì²œê°„.indexOf(hourResult.gan);
                const expectedIndex = ì²œê°„.indexOf(expectedHourGan);
                const offset = (actualIndex - expectedIndex + 10) % 10;
                console.log(`ğŸ” ì˜¤í”„ì…‹ ë¶„ì„:`);
                console.log(`  ì‹¤ì œ ì¸ë±ìŠ¤: ${actualIndex} (${hourResult.gan})`);
                console.log(`  ì˜ˆìƒ ì¸ë±ìŠ¤: ${expectedIndex} (${expectedHourGan})`);
                console.log(`  ì˜¤í”„ì…‹: +${offset}`);
            }

            console.log('ğŸ” === ì‹¤ì œ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===\n');

            return {
                fullSaju: sajuResult,
                dayCalculation: { gan: dayGan, ji: dayJi, pillar: `${dayGan}${dayJi}` },
                hourCalculation: { gan: hourResult.gan, ji: hourResult.ji, pillar: `${hourResult.gan}${hourResult.ji}` },
                expected: { gan: expectedHourGan, ji: ì§€ì§€[hourJiIndex], pillar: `${expectedHourGan}${ì§€ì§€[hourJiIndex]}` },
                isCorrect: hourResult.gan === expectedHourGan,
                debugInfo: {
                    dayGanIndex,
                    hourJiIndex,
                    ìì‹œì²œê°„,
                    expectedHourGanIndex
                }
            };
        }

        // HTML ì¶œë ¥ í•¨ìˆ˜
        function displayResults() {
            const output = document.getElementById('test-output');

            // ì½˜ì†” í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            console.clear();
            const result = testRealSystem();

            let html = '<div class="test-box">';
            html += '<h2>ğŸ¯ ì‹¤ì œ ì‹œìŠ¤í…œ ê³„ì‚° ê²°ê³¼</h2>';
            html += '<table>';
            html += '<tr><th>êµ¬ë¶„</th><th>ê³„ì‚° ê²°ê³¼</th><th>ì˜ˆìƒ ê²°ê³¼</th><th>ìƒíƒœ</th></tr>';
            html += `<tr><td>ì¼ì£¼</td><td><span class="highlight">${result.dayCalculation.pillar}</span></td><td>ë¬´ì˜¤</td><td>${result.dayCalculation.pillar === 'ë¬´ì˜¤' ? '<span class="success">âœ… ì •í™•</span>' : '<span class="error">âŒ ì˜¤ë¥˜</span>'}</td></tr>`;
            html += `<tr><td>ì‹œì£¼</td><td><span class="highlight">${result.hourCalculation.pillar}</span></td><td>ë¬´ì˜¤</td><td>${result.hourCalculation.pillar === 'ë¬´ì˜¤' ? '<span class="success">âœ… ì •í™•</span>' : '<span class="error">âŒ ì˜¤ë¥˜</span>'}</td></tr>`;
            html += '</table>';
            html += '</div>';

            // ì „ì²´ ì‚¬ì£¼ í‘œì‹œ
            html += '<div class="test-box">';
            html += '<h2>ğŸ“Š ì „ì²´ ì‚¬ì£¼íŒ”ì</h2>';
            html += '<table>';
            html += '<tr><th>êµ¬ë¶„</th><th>ì²œê°„</th><th>ì§€ì§€</th><th>ê°„ì§€</th></tr>';
            html += `<tr><td>ë…„ì£¼</td><td>${result.fullSaju.year.gan}</td><td>${result.fullSaju.year.ji}</td><td>${result.fullSaju.year.gan}${result.fullSaju.year.ji}</td></tr>`;
            html += `<tr><td>ì›”ì£¼</td><td>${result.fullSaju.month.gan}</td><td>${result.fullSaju.month.ji}</td><td>${result.fullSaju.month.gan}${result.fullSaju.month.ji}</td></tr>`;
            html += `<tr><td>ì¼ì£¼</td><td>${result.fullSaju.day.gan}</td><td>${result.fullSaju.day.ji}</td><td>${result.fullSaju.day.gan}${result.fullSaju.day.ji}</td></tr>`;
            html += `<tr><td>ì‹œì£¼</td><td>${result.fullSaju.hour.gan}</td><td>${result.fullSaju.hour.ji}</td><td>${result.fullSaju.hour.gan}${result.fullSaju.hour.ji}</td></tr>`;
            html += '</table>';
            html += '</div>';

            // ë””ë²„ê¹… ì •ë³´
            html += '<div class="test-box">';
            html += '<h2>ğŸ” ë””ë²„ê¹… ì •ë³´</h2>';
            html += `<div class="step-by-step">dayGanIndex = ${result.debugInfo.dayGanIndex} (${result.dayCalculation.gan})</div>`;
            html += `<div class="step-by-step">hourJiIndex = ${result.debugInfo.hourJiIndex} (${result.hourCalculation.ji})</div>`;
            html += `<div class="step-by-step">ìì‹œì²œê°„ = ${result.debugInfo.ìì‹œì²œê°„}</div>`;
            html += `<div class="step-by-step">ì˜ˆìƒ hourGanIndex = ${result.debugInfo.expectedHourGanIndex}</div>`;
            html += `<div class="step-by-step">ì‹¤ì œ ê²°ê³¼: ${result.hourCalculation.gan} vs ì˜ˆìƒ ê²°ê³¼: ${result.expected.gan}</div>`;
            html += '</div>';

            // ë‹¤ìŒ ë‹¨ê³„ ì•ˆë‚´
            html += '<div class="test-box">';
            html += '<h2>ğŸ“‹ ë‹¤ìŒ ë‹¨ê³„</h2>';
            if (!result.isCorrect) {
                html += '<div class="step-by-step"><span class="error">âŒ ì‹œì£¼ ê³„ì‚° ì˜¤ë¥˜ í™•ì¸ë¨</span></div>';
                html += '<div class="step-by-step">1. F12 â†’ Console íƒ­ì—ì„œ ìƒì„¸ ë¡œê·¸ í™•ì¸</div>';
                html += '<div class="step-by-step">2. getHourGapja í•¨ìˆ˜ ë‚´ë¶€ ë¡œì§ ê²€í†  í•„ìš”</div>';
                html += '<div class="step-by-step">3. ì›ì¸ íŠ¹ì • í›„ í•´ë‹¹ ë¶€ë¶„ ìˆ˜ì •</div>';
            } else {
                html += '<div class="step-by-step"><span class="success">âœ… ì‹œì£¼ ê³„ì‚° ì •í™•í•¨</span></div>';
                html += '<div class="step-by-step">ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¡œ ì¶”ê°€ ê²€ì¦ ê¶Œì¥</div>';
            }
            html += '</div>';

            output.innerHTML = html;
            console.log('ğŸ“‹ ìœ„ ê²°ê³¼ì™€ í•¨ê»˜ ì½˜ì†” ë¡œê·¸ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”!');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        window.onload = displayResults;
    </script>
</body>
</html>
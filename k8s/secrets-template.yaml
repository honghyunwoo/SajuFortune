# ========================================
# Kubernetes Secrets 템플릿
# ========================================
# 용도: 프로덕션 환경변수 안전 관리
# 사용법:
#   1. 이 파일을 복사: cp secrets-template.yaml secrets.yaml
#   2. <BASE64_ENCODED_VALUE> 부분을 실제 값으로 교체
#   3. 적용: kubectl apply -f k8s/secrets.yaml
#   4. ⚠️ secrets.yaml은 절대 Git에 커밋하지 마세요!
# ========================================

apiVersion: v1
kind: Secret
metadata:
  name: saju-fortune-secrets
  namespace: default
type: Opaque
data:
  # ----------------------------------------
  # Base64 인코딩 방법:
  # echo -n "your-secret-value" | base64
  # ----------------------------------------
  
  # DATABASE_URL (NeonDB 프로덕션)
  # 예: postgresql://user:pass@ep-xxx.us-east-2.aws.neon.tech/sajufortune?sslmode=require
  database-url: <BASE64_ENCODED_DATABASE_URL>
  
  # REDIS_URL (Upstash 프로덕션)
  # 예: rediss://default:xxx@us1-moved-shark-12345.upstash.io:6379
  redis-url: <BASE64_ENCODED_REDIS_URL>
  
  # SESSION_SECRET (32자+ 랜덤 문자열)
  # 생성: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
  session-secret: <BASE64_ENCODED_SESSION_SECRET>
  
  # STRIPE_SECRET_KEY (Live Mode)
  # 예: sk_live_51xxxxx
  stripe-secret-key: <BASE64_ENCODED_STRIPE_SECRET_KEY>
  
  # STRIPE_WEBHOOK_SECRET
  # 예: whsec_xxxxx
  stripe-webhook-secret: <BASE64_ENCODED_STRIPE_WEBHOOK_SECRET>
  
  # SENDGRID_API_KEY (이메일 발송)
  # 예: SG.xxxxx
  sendgrid-api-key: <BASE64_ENCODED_SENDGRID_API_KEY>
  
  # SENTRY_DSN (에러 추적)
  # 예: https://xxx@oyyy.ingest.sentry.io/zzz
  sentry-dsn: <BASE64_ENCODED_SENTRY_DSN>

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: saju-fortune-config
  namespace: default
data:
  NODE_ENV: "production"
  PORT: "5000"
  LOG_LEVEL: "warn"
  CORS_ORIGIN: "https://sajufortune.com"
  EMAIL_FROM: "noreply@sajufortune.com"
  SENTRY_ENVIRONMENT: "production"
  SENTRY_TRACES_SAMPLE_RATE: "0.1"

---
# ========================================
# 사용 예시 (Deployment에서 참조)
# ========================================
# 
# apiVersion: apps/v1
# kind: Deployment
# spec:
#   template:
#     spec:
#       containers:
#       - name: app
#         env:
#         - name: DATABASE_URL
#           valueFrom:
#             secretKeyRef:
#               name: saju-fortune-secrets
#               key: database-url
#         - name: NODE_ENV
#           valueFrom:
#             configMapKeyRef:
#               name: saju-fortune-config
#               key: NODE_ENV



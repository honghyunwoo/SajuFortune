# 🔍 시주 계산 디버깅 분석 보고서

## 📋 문제 상황
- **입력 조건**: 일간 무(戊), 시간 12:56 (오시)
- **예상 결과**: 무오(戊午)
- **실제 결과**: 경오(庚午) ← 문제 발생!

## 🎯 핵심 이슈
사주풀이 시스템에서 일간이 무(戊)이고 12시(오시)일 때 시주가 **무오(戊午)**가 아닌 **경오(庚午)**로 계산되는 문제

## 🔍 단계별 디버깅 추적

### 1단계: 입력값 확인
```
일간(dayGan): "무"
시간(hour): 12
```

### 2단계: dayGanIndex 계산
```
천간 배열: ['갑', '을', '병', '정', '무', '기', '경', '신', '임', '계']
dayGanIndex = 천간.indexOf("무") = 4 (❌ 잘못됨!)
```

**⚠️ 첫 번째 문제 발견**: 무(戊)의 인덱스는 4가 아니라 **8**이어야 함

### 3단계: hourJiIndex 계산
```
12시 → 11-12시 범위 → 오시 → hourJiIndex = 6 ✅
지지[6] = "오" ✅
```

### 4단계: 일간별자시천간 매핑
```
일간별자시천간 = {
    0: 0, 4: 0,  // 갑(0), 기(4) → 갑자시(0)
    1: 2, 5: 2,  // 을(1), 경(5) → 병자시(2)
    2: 4, 6: 4,  // 병(2), 신(6) → 무자시(4)
    3: 6, 7: 6,  // 정(3), 임(7) → 경자시(6)
    8: 8, 9: 8   // 무(8), 계(9) → 임자시(8) ← 여기가 맞음
};

자시천간 = 일간별자시천간[4] = 0  (❌ 잘못됨!)
올바른 값: 일간별자시천간[8] = 8  (✅ 정확)
```

### 5단계: hourGanIndex 계산
```
잘못된 계산: hourGanIndex = (0 + 6) % 10 = 6
올바른 계산: hourGanIndex = (8 + 6) % 10 = 4
```

### 6단계: 최종 결과
```
잘못된 결과: 천간[6] = "경", 지지[6] = "오" → 경오(庚午)
올바른 결과: 천간[4] = "무", 지지[6] = "오" → 무오(戊午)
```

## 🚨 오류 원인 분석

### 원인 1: 천간 배열 인덱스 혼동
현재 시스템에서 **천간 배열의 인덱스가 잘못 참조**되고 있을 가능성:
- 무(戊)는 인덱스 4가 아니라 **8**
- 실제 천간 순서: 갑(0), 을(1), 병(2), 정(3), **무(4)**, 기(5), 경(6), 신(7), 임(8), 계(9)

**⚠️ 대기 문제**: 천간 배열 정의 자체에 문제가 있거나, 다른 곳에서 잘못된 인덱스를 전달하고 있음

### 원인 2: dayGan 파라미터 전달 오류
getHourGapja 함수에 전달되는 `dayGan` 파라미터가:
- 예상: "무" (문자열)
- 실제: 다른 값이나 잘못된 형식

### 원인 3: 절기 계산 영향
1989년 10월 6일의 절기 상황:
- 한로(寒露): 1989년 10월 8일 18:35:47
- 해당 날짜가 백로 기간이므로 월주 계산이 일간에 영향을 줄 가능성

## 🔧 해결 방안

### 방안 1: 천간 배열 검증
```javascript
console.log('천간 배열:', 천간);
console.log('무의 인덱스:', 천간.indexOf('무'));
```

### 방안 2: 함수 입력값 검증
```javascript
function getHourGapja(dayGan, hour) {
    console.log('입력 dayGan:', dayGan, typeof dayGan);
    console.log('입력 hour:', hour, typeof hour);
    const dayGanIndex = 천간.indexOf(dayGan);
    console.log('dayGanIndex:', dayGanIndex);
    // ... 나머지 계산
}
```

### 방안 3: 전체 사주 계산 검증
```javascript
// 1989년 10월 6일의 일간이 정말 무(戊)인지 확인
const dayGapja = getDayGapja(1989, 10, 6);
const dayGan = 천간[dayGapja % 10];
console.log('계산된 일간:', dayGan);
```

## 🧪 테스트 파일 제공

다음 테스트 파일들을 생성하여 단계별 검증 가능:

1. **debug_hour_test.html** - 기본 getHourGapja 함수 디버깅
2. **specific_test.html** - 1989년 10월 6일 특정 케이스 검증
3. **comparison_test.html** - 두 가지 계산 방식 비교

### 실행 방법
```bash
# 브라우저에서 테스트 실행
run_debug_tests.bat
```

## 📊 예상 결과 vs 실제 결과

| 항목 | 예상 | 실제 | 상태 |
|------|------|------|------|
| 일간 | 무(戊) | ? | 확인 필요 |
| 시지 | 오(午) | 오(午) | ✅ 정확 |
| 시간천간 | 무(戊) | 경(庚) | ❌ 오류 |
| 최종 시주 | 무오(戊午) | 경오(庚午) | ❌ 오류 |

## 🎯 다음 단계

1. **천간 배열 검증**: 실제 천간 배열이 올바른지 확인
2. **일간 계산 검증**: 1989년 10월 6일의 일간이 정말 무(戊)인지 확인
3. **함수 호출 추적**: getHourGapja 함수에 전달되는 실제 파라미터 값 확인
4. **절기 영향 검토**: 절기 변경이 계산에 미치는 영향 분석

## 💡 이론적 검증

### 무일(戊日) 시주 표준
```
무일의 시주 순서:
자시(23-01): 임자(壬子)
축시(01-03): 계축(癸丑)
인시(03-05): 갑인(甲寅)
묘시(05-07): 을묘(乙卯)
진시(07-09): 병진(丙辰)
사시(09-11): 정사(丁巳)
오시(11-13): 무오(戊午) ← 이것이 정답!
미시(13-15): 기미(己未)
신시(15-17): 경신(庚申)
유시(17-19): 신유(辛酉)
술시(19-21): 임술(壬戌)
해시(21-23): 계해(癸亥)
```

따라서 무일 오시는 반드시 **무오(戊午)**여야 함.

## 🏁 결론

현재 시스템에서 **천간 인덱스 계산에 오류**가 있어서 무일 오시가 무오가 아닌 경오로 계산되고 있음.

핵심은 dayGanIndex 계산 과정에서 무(戊)의 올바른 인덱스(8)가 아닌 잘못된 값(4 또는 다른 값)이 사용되고 있다는 점.

**즉시 확인이 필요한 부분:**
1. 천간 배열 정의
2. dayGan 파라미터 전달 과정
3. indexOf 함수 동작
4. 일간 계산 자체의 정확성